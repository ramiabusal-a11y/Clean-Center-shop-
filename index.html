<!-- vercel-build-output: static -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù†ÙŠÙˆ-Ù…ÙˆØ±ÙÙŠØ²Ù… (Ù…Ø³ØªÙ‚Ø±)</title>
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© React Ùˆ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Chart.js Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Sheet.js Ù„ØªØµØ¯ÙŠØ± Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    
    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#6366f1', // Indigo
                        'secondary': '#f97316', // Orange
                        'neumo-base': '#e0e5ec', // Light Gray Base for Neumorphism
                        'neumo-dark': '#a3b1c6',
                        'neumo-light': '#ffffff',
                    },
                }
            }
        }
    </script>

    <style>
        /* Ø®Ø· Inter (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù€ Tailwind) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e0e5ec; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù†ÙŠÙˆÙ…ÙˆØ±ÙÙŠØ²Ù… */
            min-height: 100vh;
        }
        
        /* Neumorphism Base Style (Raised effect) */
        .neumo-card {
            background-color: #e0e5ec;
            border-radius: 20px;
            box-shadow: 8px 8px 16px #a3b1c6, -8px -8px 16px #ffffff;
            @apply p-5 rounded-2xl;
        }
        
        /* Neumorphism Input Style (Pressed effect) */
        .neumo-input {
            background-color: #e0e5ec;
            border-radius: 10px;
            box-shadow: inset 2px 2px 5px #a3b1c6, inset -2px -2px 5px #ffffff;
            @apply w-full p-3 rounded-xl border-none text-gray-800 placeholder-gray-500 transition duration-200 focus:ring-primary focus:shadow-none;
        }
        .neumo-input:focus {
            box-shadow: inset 1px 1px 2px #a3b1c6, inset -1px -1px 2px #ffffff;
        }

        /* Neumorphism Button Style (Raised) */
        .neumo-btn {
            background-color: #e0e5ec;
            border-radius: 12px;
            box-shadow: 4px 4px 8px #a3b1c6, -4px -4px 8px #ffffff;
            @apply text-gray-700 font-bold py-3 px-6 transition-all duration-300 transform hover:shadow-none hover:scale-[0.98];
        }
        
        /* Primary Neumorphism Button (Colored) */
        .neumo-btn-primary {
            background-color: #6366f1; /* Primary color */
            box-shadow: 4px 4px 8px #484bac, -4px -4px 8px #7e80ff;
            @apply text-white hover:bg-indigo-600 hover:shadow-inner;
        }
        
        /* Secondary Neumorphism Button (Colored) */
        .neumo-btn-secondary {
            background-color: #f97316; /* Secondary color */
            box-shadow: 4px 4px 8px #b4570d, -4px -4px 8px #ff8f1f;
            @apply text-white hover:bg-orange-600 hover:shadow-inner;
        }

        /* CSS for Print (A4) */
        @media print {
            body {
                background: white; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
                color: black;
            }
            .no-print {
                display: none !important;
            }
            .print-area {
                width: 210mm; /* Ø¹Ø±Ø¶ A4 */
                height: 297mm; /* Ø§Ø±ØªÙØ§Ø¹ A4 */
                margin: 0;
                padding: 10mm;
                box-shadow: none;
            }
            /* Ø¥Ø®ÙØ§Ø¡ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ³ÙˆÙ‚ */
            .shop-cart {
                display: none !important;
            }
            /* Ø¥Ø²Ø§Ù„Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†ÙŠÙˆÙ…ÙˆØ±ÙÙŠØ²Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
            .neumo-card, .neumo-input, .neumo-btn {
                box-shadow: none !important;
                background-color: white !important;
                border: 1px solid #ccc !important;
            }
            table th, table td {
                border-color: #000 !important;
                color: #000 !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div id="root">
        <!-- ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ React Ù‡Ù†Ø§ -->
    </div>

    <script>
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… React.createElement Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† JSX
        const { createElement: e, useState, useEffect, useCallback, useMemo, useRef } = React;
        const { createRoot } = ReactDOM;

        // ====================================================================================
        // 1. IndexedDB Utility - Ø£Ø¯Ø§Ø© ØªØ®Ø²ÙŠÙ† IndexedDB (ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹)
        // ====================================================================================
        const DB_NAME = 'ECommerceStoreDB';
        const DB_VERSION = 1;
        const STORE_NAMES = ['categories', 'products', 'settings', 'cart'];
        
        let db;

        const openDB = () => new Promise((resolve, reject) => {
            if (db) return resolve(db);

            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onupgradeneeded = (event) => {
                const dbInstance = event.target.result;
                STORE_NAMES.forEach(storeName => {
                    if (!dbInstance.objectStoreNames.contains(storeName)) {
                        dbInstance.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
                    }
                });
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };

            request.onerror = (event) => {
                console.error("IndexedDB Error:", event.target.error);
                reject(event.target.error);
            };
        });

        const idb = {
            async getAll(storeName) {
                const dbInstance = await openDB();
            <!-- âœ… Ø±Ø¨Ø· Firebase Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Vercel -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
  // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Config Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù…Ø´Ø±ÙˆØ¹Ùƒ cleane-center-shop
  const firebaseConfig = {
    apiKey: "AIzaSyAQE_hCUNxo9_hFhSL5U2Jv5",
    authDomain: "cleane-center-shop.firebaseapp.com",
    projectId: "cleane-center-shop",
    storageBucket: "cleane-center-shop.appspot.com",
    messagingSenderId: "687911431635",
    appId: "1:687911431635:web:d6580f8b6d861d4d",
    measurementId: "G-TXDX6L3RV5"
  };

  // ğŸš€ ØªØ´ØºÙŠÙ„ Firebase ÙˆØ±Ø¨Ø· Firestore
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  console.log("âœ… Firebase ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ù…Ø´Ø±ÙˆØ¹ cleane-center-shop");
</script>  
                const dbInstance = await openDB();
                return new Promise((resolve, reject) => {
                    const transaction = dbInstance.transaction(STORE_NAMES, 'readwrite');
                    let cleared = 0;
                    
                    STORE_NAMES.forEach(storeName => {
                        const store = transaction.objectStore(storeName);
                        store.clear().onsuccess = () => {
                            cleared++;
                            if (cleared === STORE_NAMES.length) resolve();
                        };
                    });

                    transaction.onerror = () => reject(transaction.error);
                });
            },
            async importData(data) {
                const dbInstance = await openDB();
                return new Promise((resolve, reject) => {
                    const transaction = dbInstance.transaction(STORE_NAMES, 'readwrite');
                    let importedCount = 0;
                    
                    STORE_NAMES.forEach(storeName => {
                        if (data[storeName] && Array.isArray(data[storeName])) {
                            const store = transaction.objectStore(storeName);
                            data[storeName].forEach(item => {
                                store.put(item); 
                            });
                            importedCount++;
                        } else {
                            importedCount++; 
                        }
                    });

                    transaction.oncomplete = () => resolve();
                    transaction.onerror = () => reject(transaction.error);
                });
            },
            async exportData() {
                const exportedData = {};
                for (const storeName of STORE_NAMES) {
                    exportedData[storeName] = await idb.getAll(storeName);
                }
                return exportedData;
            }
        };


        // ====================================================================================
        // 2. Core Components - Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        // ====================================================================================

        /**
         * Ù…ÙƒÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„
         */
        const Alert = ({ message, type = 'info', onClose }) => {
            const baseClasses = "neumo-card p-4 rounded-xl shadow-lg flex justify-between items-center fixed top-4 left-1/2 -translate-x-1/2 z-50 min-w-[300px] max-w-full transition-all duration-300 transform";
            let colorClasses = "";
            let textClasses = "text-gray-900";

            switch (type) {
                case 'success':
                    colorClasses = "bg-green-100 border-l-4 border-green-500"; 
                    break;
                case 'error':
                    colorClasses = "bg-red-100 border-l-4 border-red-500"; 
                    break;
                case 'warning':
                    colorClasses = "bg-yellow-100 border-l-4 border-yellow-500"; 
                    break;
                case 'info':
                default:
                    colorClasses = "bg-blue-100 border-l-4 border-blue-500"; 
                    break;
            }
            
            // Adjust neumorphism style for alerts to be slightly recessed
            const neumorphismStyle = {
                boxShadow: 'inset 2px 2px 5px #a3b1c6, inset -2px -2px 5px #ffffff',
                backgroundColor: '#f0f4f8'
            };

            return e('div', { className: `${baseClasses} ${colorClasses} animate-pulse`, style: neumorphismStyle },
                e('p', { className: textClasses }, message),
                onClose && e('button', {
                    onClick: onClose,
                    className: "ml-4 text-gray-600 hover:text-gray-900 transition"
                }, 'Ã—')
            );
        };

        /**
         * Ù…ÙƒÙˆÙ† Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
         */
        const LoadingSpinner = () => e('div', { className: "flex justify-center items-center h-[calc(100vh-64px)] w-full" },
            e('div', { className: "animate-spin rounded-full h-12 w-12 border-b-4 border-primary" })
        );

        // ====================================================================================
        // 3. Application Context and State - Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ====================================================================================

        const AppContext = React.createContext();

        const AppProvider = ({ children }) => {
            const [page, setPage] = useState('home'); 
            const [categories, setCategories] = useState([]);
            const [products, setProducts] = useState([]);
            const [settings, setSettings] = useState({ 
                whatsappNumber: '', 
                adminPassword: '12345', 
                storeName: 'Ù…ØªØ¬Ø±Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 
                storeImage: '',
                // Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                lastBackupDate: null 
            });
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [alert, setAlert] = useState(null); 
            const [cart, setCart] = useState({}); 
            const [lastBackupDate, setLastBackupDate] = useState(null); // ÙŠØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶
            
            const showAlert = useCallback((message, type = 'info', duration = 4000) => {
                setAlert({ message, type });
                if (duration > 0) {
                    setTimeout(() => setAlert(null), duration);
                }
            }, []);

            // ** ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù…Ù† IndexedDB (ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹) **
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const [cats, prods, storedSettings] = await Promise.all([
                            idb.getAll('categories'),
                            idb.getAll('products'),
                            idb.getAll('settings'),
                        ]);
                        setCategories(cats);
                        setProducts(prods);
                        
                        if (storedSettings.length > 0) {
                            const loadedSettings = storedSettings[0];
                            const finalSettings = {
                                ...settings,
                                ...loadedSettings,
                                adminPassword: loadedSettings.adminPassword || '12345' 
                            };
                            setSettings(finalSettings);
                            setLastBackupDate(finalSettings.lastBackupDate || null);
                        } else {
                            await idb.put('settings', { id: crypto.randomUUID(), ...settings });
                        }
                        
                    } catch (error) {
                        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.', 'error');
                        console.error('Initial data load error:', error);
                    } finally {
                        setIsLoading(false);
                    }
                };
                loadData();
            }, [showAlert]); 

            // ** ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (IndexedDB) **
            const saveSettings = useCallback(async (newSettings) => {
                try {
                    const currentSettingsList = await idb.getAll('settings');
                    const currentSettings = currentSettingsList.length > 0 ? currentSettingsList[0] : { id: crypto.randomUUID() };
                    
                    const settingsToSave = { 
                        ...currentSettings, 
                        ...settings,
                        ...newSettings 
                    };
                    
                    await idb.put('settings', settingsToSave);
                    setSettings(settingsToSave);
                    showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.', 'success', 2000);
                    return settingsToSave;
                } catch (error) {
                    showAlert('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.', 'error');
                    console.error('Settings save error:', error);
                    return null;
                }
            }, [showAlert, settings]);

            // ** ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§ (CRUD - IndexedDB) **
            const updateData = useCallback(async (storeName, data, isDelete = false) => {
                setIsLoading(true);
                try {
                    if (isDelete) {
                        await idb.delete(storeName, data.id);
                        showAlert('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­.', 'success', 2000);
                    } else {
                        const newId = await idb.put(storeName, data);
                        if (!data.id) data.id = newId; 
                        showAlert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­.', 'success', 2000);
                    }
                    
                    const updatedList = await idb.getAll(storeName);
                    if (storeName === 'categories') setCategories(updatedList);
                    if (storeName === 'products') setProducts(updatedList);
                    
                } catch (error) {
                    showAlert('ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸/Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
                    console.error('Data update error:', error);
                } finally {
                    setIsLoading(false);
                }
            }, [showAlert]);
            
            // ** ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (IndexedDB - ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹) **
            const exportJson = useCallback(async () => {
                try {
                    const data = await idb.exportData();
                    const jsonString = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ecom_backup_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    const now = new Date().toISOString();
                    setLastBackupDate(now);
                    await saveSettings({ lastBackupDate: now });
                    
                    showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ù„Ù JSON.', 'success');
                } catch (error) {
                    showAlert('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± JSON.', 'error');
                    console.error('Export JSON error:', error);
                }
            }, [showAlert, saveSettings]);

            const importJson = useCallback((e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        await idb.importData(data);
                        
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ React state
                        const [cats, prods, storedSettings] = await Promise.all([
                            idb.getAll('categories'),
                            idb.getAll('products'),
                            idb.getAll('settings'),
                        ]);
                        setCategories(cats);
                        setProducts(prods);
                        if (storedSettings.length > 0) {
                            const finalSettings = { ...settings, ...storedSettings[0] };
                            setSettings(finalSettings);
                        }
                        
                        const now = new Date().toISOString();
                        setLastBackupDate(now);
                        await saveSettings({ lastBackupDate: now });

                        showAlert('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­. Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ø¯ÙŠØ±.', 'success', 5000);
                    } catch (error) {
                        showAlert('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ù„Ù Ø¨ØµÙŠØºØ© JSON ØµØ­ÙŠØ­Ø©.', 'error', 7000);
                        console.error('Import JSON error:', error);
                    }
                };
                reader.readAsText(file);
            }, [showAlert, saveSettings, settings]);

            const exportExcel = useCallback(async () => {
                try {
                    const data = await idb.exportData();
                    const workbook = XLSX.utils.book_new();

                    const productData = data.products.map(p => ({
                        'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬': p.name,
                        'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ': p.price,
                        'Ø§Ù„ÙˆØµÙ': p.description,
                        'ID Ø§Ù„Ù‚Ø³Ù…': p.categoryId,
                        'Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Variants)': p.variants.length
                    }));
                    XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(productData), 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');

                    const categoryData = data.categories.map(c => ({
                        'ID Ø§Ù„Ù‚Ø³Ù…': c.id,
                        'Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…': c.name,
                    }));
                    XLSX.utils.book_append_sheet(workbook, XLSX.utils.json_to_sheet(categoryData), 'Ø§Ù„Ø£Ù‚Ø³Ø§Ù…');

                    XLSX.writeFile(workbook, `ecom_report_${new Date().toISOString().slice(0, 10)}.xlsx`);
                    showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ù„Ù Excel.', 'success');
                } catch (error) {
                    showAlert('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Excel.', 'error');
                    console.error('Export Excel error:', error);
                }
            }, [showAlert]);
            
            // ** ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (IndexedDB) **
            const deleteAllData = useCallback(async () => {
                if (!window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª) Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                    return;
                }
                setIsLoading(true);
                try {
                    await idb.clearAll();
                    setCategories([]);
                    setProducts([]);
                    setSettings({ whatsappNumber: '', adminPassword: '12345', storeName: 'Ù…ØªØ¬Ø±Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', storeImage: '' });
                    setIsAdminAuthenticated(false);
                    setCart({});
                    setLastBackupDate(null);
                    setPage('home');
                    showAlert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.', 'success', 5000);
                } catch (error) {
                    showAlert('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
                    console.error('Delete all data error:', error);
                } finally {
                    setIsLoading(false);
                }
            }, [showAlert, setPage]);

            // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³Ù„Ø©
            const updateCart = useCallback((product, variant, quantity) => {
                const key = `${product.id}_${variant.id}`; 
                setCart(prevCart => {
                    const newCart = { ...prevCart };
                    
                    if (quantity <= 0) {
                        delete newCart[key];
                    } else {
                        newCart[key] = { product, variant, quantity };
                    }
                    return newCart;
                });
                showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚.', 'info', 1000);
            }, [showAlert]);

            const clearCart = useCallback(() => {
                setCart({});
                showAlert('ØªÙ… Ø¥ÙØ±Ø§Øº Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚.', 'info', 1000);
            }, [showAlert]);


            const contextValue = {
                page, setPage, categories, products, settings,
                isLoading, showAlert, alert, setAlert,
                updateData, saveSettings,
                cart, updateCart, clearCart,
                exportJson, importJson, exportExcel, 
                deleteAllData,
                lastBackupDate,
                isAdminAuthenticated, setIsAdminAuthenticated
            };

            return e(AppContext.Provider, { value: contextValue },
                children,
                alert && e(Alert, { ...alert, onClose: () => setAlert(null) })
            );
        };


        // ====================================================================================
        // 4. Shared UI Components - Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© 
        // ====================================================================================

        /**
         * Ù…ÙƒÙˆÙ† Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
         */
        const PrimaryButton = ({ children, onClick, disabled = false, className = '', isSecondary = false, isDanger = false, isSuccess = false }) => {
            let baseClasses = 'neumo-btn neumo-btn-primary';
            if (isSecondary) {
                baseClasses = 'neumo-btn neumo-btn-secondary';
            } else if (isDanger) {
                baseClasses = 'neumo-btn bg-red-500 text-white hover:bg-red-600';
            } else if (isSuccess) {
                 baseClasses = 'neumo-btn bg-green-500 text-white hover:bg-green-600';
            }
            
            return e('button', {
                onClick,
                disabled,
                className: `${baseClasses} ${disabled ? 'opacity-50 cursor-not-allowed !shadow-none' : ''} ${className}`, 
            }, children);
        };
            
        /**
         * Ø£ÙŠÙ‚ÙˆÙ†Ø© (SVG) - ØªØ³ØªØ®Ø¯Ù… Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
         */
        const Icon = ({ name, className = 'w-6 h-6' }) => {
            const getPath = (iconName) => {
                switch (iconName) {
                    case 'shop': return "M16 11V7a4 4 0 0 0-8 0v4M12 18V2H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-4v16a2 2 0 0 1-2 2z";
                    case 'admin': return "M10 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-7 9a7 7 0 1 1 14 0H3z";
                    case 'home': return "M3 12l2-2m0 0l7-7 7 7M5 10v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-7";
                    case 'plus': return "M12 4.5v15m7.5-7.5h-15";
                    case 'edit': return "M12 20h9M16.5 3.5l4 4L7.5 20.5H3v-4L16.5 3.5z";
                    case 'delete': return "M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v2m-7 3h14";
                    case 'settings': return "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z";
                    case 'dashboard': return "M3 3h7v7H3zm11 0h7v7h-7zm-11 11h7v7H3zm11 0h7v7h-7z";
                    case 'whatsapp': return "M12 2a10 10 0 0 0-7.3 16.9l-1.9 2.1 2.5-4.5A9.8 9.8 0 0 0 2 12a10 10 0 0 1 20 0 9.8 9.8 0 0 1-1.3 5.4l1.9 2.1-1.9-2.1A10 10 0 0 0 12 2zm1 14.5c-.3 0-.5-.1-.7-.3l-1.9-2.1c-.2-.2-.3-.5-.3-.8s.1-.6.3-.8l2.1-2.1c.2-.2.5-.3.8-.3s.6.1.8.3l.7.7c.2.2.3.5.3.8s-.1.6-.3.8l-1.9 2.1c.2.2.3.5.3.8s-.1.6-.3.8l.7.7c.2.2.3.5.3.8s-.1.6-.3.8l-1.9 2.1c-.2.2-.5.3-.8.3z";
                    case 'export': return "M12 18V6M9 13l3-3 3 3M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3";
                    case 'import': return "M12 6v12M9 11l3 3 3-3M21 16v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-3";
                    case 'trash': return "M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v2m-7 3h14";
                    case 'file-json': return "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM14 2v6h6";
                    case 'file-excel': return "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zM14 2v6h6M8 12h8M8 16h8";
                    case 'cart': return "M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5H21M17 17a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm-6 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z";
                    case 'close': return "M6 18L18 6M6 6l12 12";
                    case 'back': return "M15 18l-6-6 6-6";
                    case 'print': return "M17 17H7V7h10M17 11V7h-4V4H7v13h10M17 11H7";
                    case 'lock': return "M12 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0-10a8 8 0 1 0 0 16A8 8 0 0 0 12 5z";
                    case 'list': return "M4 6h16M4 12h16M4 18h16"; // Ù‚Ø§Ø¦Ù…Ø© (Menu)
                    default: return "M4 6h16M4 12h16M4 18h16"; // Ù‚Ø§Ø¦Ù…Ø© (Menu)
                }
            };

            return e('svg', {
                className: className,
                xmlns: "http://www.w3.org/2000/svg",
                fill: "none",
                viewBox: "0 0 24 24",
                stroke: "currentColor",
                strokeWidth: "2",
                'aria-hidden': "true",
            }, e('path', {
                strokeLinecap: "round",
                strokeLinejoin: "round",
                d: getPath(name)
            }));
        };
        
        // ====================================================================================
        // 5. Admin Panel Components - Ù…ÙƒÙˆÙ†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±
        // ====================================================================================

        /**
         * Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
         */
        const AdminLoginScreen = () => {
            const { setPage, settings, isAdminAuthenticated, setIsAdminAuthenticated, showAlert } = React.useContext(AppContext);
            const [password, setPassword] = useState('');
            
            const handleLogin = (e) => {
                e.preventDefault();
                // Ù…Ù‚Ø§Ø±Ù†Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ø¨ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø®Ø²Ù†Ø©
                if (password === settings.adminPassword) {
                    setIsAdminAuthenticated(true);
                    setPage('admin');
                    showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.', 'success', 2000);
                } else {
                    showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.', 'error', 3000);
                    setPassword('');
                }
            };

            return e('div', { className: "min-h-[calc(100vh-64px)] flex flex-col items-center justify-center p-4" },
                e('div', { className: "neumo-card text-center p-8 md:p-12 max-w-sm w-full relative" },
                    // Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹
                    e(PrimaryButton, { onClick: () => setPage('home'), className: "absolute top-4 right-4 !bg-neumo-base text-gray-700 hover:text-gray-900 flex items-center p-2 text-sm" }, 
                        e(Icon, { name: 'back', className: "w-4 h-4 ml-2" }), 'Ø¹ÙˆØ¯Ø©'
                    ),
                    
                    e('form', { onSubmit: handleLogin },
                        e('h1', { className: "text-3xl font-extrabold text-gray-800 mb-6 mt-6" }, 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±'),
                        e('p', { className: "text-gray-600 mb-6" }, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.'),
                        
                        e('div', { className: "mb-6" },
                            e('input', {
                                type: 'password',
                                value: password,
                                onChange: (e) => setPassword(e.target.value),
                                className: "neumo-input text-center",
                                placeholder: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                                required: true
                            })
                        ),
                        
                        e(PrimaryButton, { type: 'submit', className: "w-full flex items-center justify-center neumo-btn-primary" }, 
                            e(Icon, { name: 'lock', className: "w-5 h-5 ml-2" }), 'Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±'
                        )
                    )
                )
            );
        };

        // ... (Ø¨Ù‚ÙŠØ© Ù…ÙƒÙˆÙ†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠØŒ ÙˆØ³ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ SettingsManager)
        
        /**
         * Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© (Dashboard)
         */
        const Dashboard = () => {
            const { categories, products, lastBackupDate } = React.useContext(AppContext);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const stats = useMemo(() => {
                const categoryCount = categories.length;
                const productCount = products.length;
                
                const totalVariants = products.reduce((acc, p) => acc + (p.variants ? p.variants.length : 0), 0);

                const productDistribution = categories.map(cat => {
                    const count = products.filter(p => p.categoryId === cat.id).length;
                    return { name: cat.name, count };
                });
                
                return { categoryCount, productCount, totalVariants, productDistribution };
            }, [categories, products]);
            
            // Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            useEffect(() => {
                if (chartRef.current && stats.productCount > 0) {
                    const data = stats.productDistribution.map(d => d.count);
                    const labels = stats.productDistribution.map(d => d.name);
                    
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                    
                    const ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: [
                                    '#6366f1', // Primary
                                    '#f97316', // Secondary
                                    '#10b981', // Green
                                    '#f59e0b', // Amber
                                    '#8b5cf6', // Violet
                                ],
                                hoverOffset: 16,
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: '#4b5563', // Dark text color for light theme
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…',
                                    color: '#1f2937', // Dark title color
                                }
                            }
                        }
                    });
                } else if (chartInstance.current) {
                    chartInstance.current.destroy();
                    chartInstance.current = null;
                }
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                        chartInstance.current = null;
                    }
                };
            }, [stats]);


            return e('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                e(StatCard, { title: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…", value: stats.categoryCount, icon: 'list' }),
                e(StatCard, { title: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", value: stats.productCount, icon: 'shop' }),
                e(StatCard, { title: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©", value: stats.totalVariants, icon: 'plus' }),

                e('div', { className: "md:col-span-2 neumo-card h-96" }, 
                    stats.productCount > 0 ? e('canvas', { ref: chartRef, className: "w-full h-full" }) : e('p', { className: "text-center text-gray-500 py-10" }, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ²ÙŠØ¹.'),
                ),

                e('div', { className: "neumo-card md:col-span-1" },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4 border-b border-gray-300 pb-2" }, 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…'),
                    e('p', { className: "text-gray-600 mb-2" }, 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:'),
                    e('p', { className: "text-sm text-gray-800 font-mono" }, 
                        lastBackupDate ? new Date(lastBackupDate).toLocaleString('ar-EG', { dateStyle: 'medium', timeStyle: 'short' }) : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ø¹Ø¯'
                    ),
                    e('p', { className: "text-sm text-primary mt-4" }, 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ø¨Ø± IndexedDB.')
                )
            );
        };
        
        const StatCard = ({ title, value, icon }) => e('div', { className: "neumo-card flex items-center justify-between" },
            e('div', null,
                e('p', { className: "text-sm font-medium text-gray-600" }, title),
                e('p', { className: "text-3xl font-bold text-gray-800 mt-1" }, value)
            ),
            e(Icon, { name: icon, className: "w-10 h-10 text-primary/70" })
        );

        // ** CategoryManager **
        const CategoryManager = () => { 
            const { categories, updateData, showAlert } = React.useContext(AppContext);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [currentCategory, setCurrentCategory] = useState(null);
            const [name, setName] = useState('');
            const [image, setImage] = useState(null); 
            
            const openModal = (category = null) => {
                setCurrentCategory(category);
                setName(category ? category.name : '');
                setImage(category ? category.image : null);
                setIsModalOpen(true);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setCurrentCategory(null);
                setName('');
                setImage(null);
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => { setImage(event.target.result); };
                reader.onerror = () => showAlert('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.', 'error');
                reader.readAsDataURL(file);
            };

            const handleSave = async () => {
                if (!name.trim()) { return showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù….', 'warning'); }
                
                const categoryToSave = {
                    id: currentCategory ? currentCategory.id : null,
                    name: name.trim(),
                    image: image,
                };

                await updateData('categories', categoryToSave);
                closeModal();
            };
            
            const CategoryTable = e('div', { className: "overflow-x-auto neumo-card mt-6" },
                e('table', { className: "min-w-full divide-y divide-gray-300" }, 
                    e('thead', { className: "bg-neumo-base" }, 
                        e('tr', null,
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, 'Ø§Ù„ØµÙˆØ±Ø©'),
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, 'Ø§Ù„Ø§Ø³Ù…'),
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider hidden sm:table-cell" }, 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª'),
                            e('th', { className: "relative px-6 py-3" }, 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª')
                        )
                    ),
                    e('tbody', { className: "divide-y divide-gray-200 text-gray-800" }, 
                        categories.map(cat => e('tr', { key: cat.id },
                            e('td', { className: "px-6 py-4 whitespace-nowrap" }, 
                                cat.image ? e('img', { src: cat.image, className: "w-12 h-12 rounded-lg object-cover neumo-card !p-0" }) : e('div', { className: "w-12 h-12 bg-gray-300 rounded-lg neumo-card" })
                            ),
                            e('td', { className: "px-6 py-4 whitespace-nowrap font-medium" }, cat.name),
                            e('td', { className: "px-6 py-4 whitespace-nowrap hidden sm:table-cell" }, '0'), 
                            e('td', { className: "px-6 py-4 whitespace-nowrap text-left text-sm font-medium" },
                                e(PrimaryButton, { onClick: () => openModal(cat), className: "p-2 ml-2", isSecondary: true }, e(Icon, { name: 'edit', className: "w-4 h-4" })),
                                e(PrimaryButton, { onClick: () => updateData('categories', { id: cat.id }, true), className: "p-2", isDanger: true }, e(Icon, { name: 'delete', className: "w-4 h-4" }))
                            )
                        ))
                    )
                )
            );

            // Modal style adjusted for Neumorphism
            const modalStyle = {
                backgroundColor: '#e0e5ec',
                boxShadow: '10px 10px 20px #a3b1c6, -10px -10px 20px #ffffff'
            };

            const CategoryModal = isModalOpen && e('div', { className: "fixed inset-0 bg-gray-900 bg-opacity-40 flex items-center justify-center z-50 p-4" },
                e('div', { className: "w-full max-w-md neumo-card", style: modalStyle },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, currentCategory ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…' : 'Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯'),
                    e('div', { className: "mb-4" },
                        e('label', { className: "block text-gray-700 mb-2" }, 'Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…'),
                        e('input', {
                            type: 'text',
                            value: name,
                            onChange: (e) => setName(e.target.value),
                            className: "neumo-input",
                            placeholder: 'Ø£Ø²ÙŠØ§Ø¡ØŒ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§ØªØŒ Ø¥Ù„Ø®.'
                        })
                    ),
                    e('div', { className: "mb-4" },
                        e('label', { className: "block text-gray-700 mb-2" }, 'ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø³Ù…'),
                        image && e('img', { src: image, className: "w-24 h-24 object-cover rounded-lg mb-2 neumo-card !p-0" }),
                        e('input', {
                            type: 'file',
                            onChange: handleImageUpload,
                            accept: 'image/*',
                            className: "neumo-input file:text-white file:bg-primary file:border-none file:rounded-xl file:cursor-pointer"
                        })
                    ),
                    e('div', { className: "flex justify-end space-x-2 space-x-reverse mt-6" },
                        e(PrimaryButton, { onClick: closeModal, className: "!bg-gray-300 text-gray-700 neumo-btn" }, 'Ø¥Ù„ØºØ§Ø¡'),
                        e(PrimaryButton, { onClick: handleSave, isSuccess: true }, 'Ø­ÙØ¸')
                    )
                )
            );

            return e('div', null,
                e('div', { className: "flex justify-between items-center mb-6" },
                    e('h2', { className: "text-2xl font-bold text-gray-800" }, 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…'),
                    e(PrimaryButton, { onClick: () => openModal(), isSuccess: true }, e(Icon, { name: 'plus', className: "w-5 h-5 ml-2" }), 'Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…')
                ),
                CategoryTable,
                CategoryModal
            );
        };

        // ** ProductManager **
        const ProductManager = () => { 
            const { products, categories, updateData, showAlert } = React.useContext(AppContext);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [currentProduct, setCurrentProduct] = useState(null);
            
            const [productForm, setProductForm] = useState({
                id: null, name: '', price: 0, description: '', categoryId: categories[0]?.id || '',
                variants: [], images: {} 
            });

            const openModal = (product = null) => {
                setCurrentProduct(product);
                if (product) {
                    setProductForm(product);
                } else {
                    setProductForm({
                        id: null, name: '', price: 0, description: '', categoryId: categories[0]?.id || '',
                        variants: [], images: {}
                    });
                }
                setIsModalOpen(true);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setCurrentProduct(null);
            };
            
            const handleChange = (e) => {
                const { name, value, type } = e.target;
                setProductForm(prev => ({
                    ...prev,
                    [name]: type === 'number' ? parseFloat(value) || 0 : value
                }));
            };
            
            const handleImageUpload = (e) => {
                const files = Array.from(e.target.files);
                if (!files.length) return;

                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageId = crypto.randomUUID();
                        setProductForm(prev => ({
                            ...prev,
                            images: { ...prev.images, [imageId]: event.target.result }
                        }));
                    };
                    reader.onerror = () => showAlert('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.', 'error');
                    reader.readAsDataURL(file);
                });
            };

            const removeImage = (imageId) => {
                setProductForm(prev => {
                    const newImages = { ...prev.images };
                    delete newImages[imageId];
                    
                    const newVariants = prev.variants.map(v => ({
                        ...v,
                        imageIds: v.imageIds.filter(id => id !== imageId)
                    }));
                    
                    return { ...prev, images: newImages, variants: newVariants };
                });
            };
            
            const addVariant = () => {
                setProductForm(prev => ({
                    ...prev,
                    variants: [...prev.variants, { 
                        id: crypto.randomUUID(), 
                        color: '', 
                        size: '', 
                        priceAdjustment: 0, 
                        imageIds: [] 
                    }]
                }));
            };

            const updateVariant = (index, field, value) => {
                setProductForm(prev => {
                    const newVariants = [...prev.variants];
                    newVariants[index] = { ...newVariants[index], [field]: value };
                    return { ...prev, variants: newVariants };
                });
            };
            
            const removeVariant = (id) => {
                 setProductForm(prev => ({
                    ...prev,
                    variants: prev.variants.filter(v => v.id !== id)
                }));
            }
            
            const toggleVariantImage = (variantIndex, imageId) => {
                setProductForm(prev => {
                    const newVariants = [...prev.variants];
                    const variant = newVariants[variantIndex];
                    const imageIds = variant.imageIds;
                    
                    if (imageIds.includes(imageId)) {
                        variant.imageIds = imageIds.filter(id => id !== imageId);
                    } else {
                        variant.imageIds = [...imageIds, imageId];
                    }
                    
                    return { ...prev, variants: newVariants };
                });
            };

            const handleSave = async () => {
                if (!productForm.name.trim() || !productForm.categoryId || productForm.price <= 0) {
                    return showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù….', 'warning');
                }
                
                const isValidVariants = productForm.variants.every(v => v.color || v.size);
                if (!isValidVariants && productForm.variants.length > 0) {
                     return showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù„ÙˆÙ† Ø£Ùˆ Ø§Ù„Ø­Ø¬Ù… Ù„ÙƒÙ„ Ø®ÙŠØ§Ø± (Variant).', 'warning');
                }
                
                await updateData('products', productForm);
                closeModal();
            };

            const ProductTable = e('div', { className: "overflow-x-auto neumo-card mt-6" },
                e('table', { className: "min-w-full divide-y divide-gray-300" }, 
                    e('thead', { className: "bg-neumo-base" }, 
                        e('tr', null,
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, 'Ø§Ù„Ø§Ø³Ù…'),
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider hidden sm:table-cell" }, 'Ø§Ù„Ù‚Ø³Ù…'),
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, 'Ø§Ù„Ø³Ø¹Ø±'),
                            e('th', { className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider hidden md:table-cell" }, 'Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª'),
                            e('th', { className: "relative px-6 py-3" }, 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª')
                        )
                    ),
                    e('tbody', { className: "divide-y divide-gray-200 text-gray-800" }, 
                        products.map(p => {
                            const category = categories.find(c => c.id === p.categoryId);
                            return e('tr', { key: p.id },
                                e('td', { className: "px-6 py-4 whitespace-nowrap font-medium" }, p.name),
                                e('td', { className: "px-6 py-4 whitespace-nowrap hidden sm:table-cell" }, category ? category.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'),
                                e('td', { className: "px-6 py-4 whitespace-nowrap" }, `${p.price.toFixed(2)} Ø±.Ø³`),
                                e('td', { className: "px-6 py-4 whitespace-nowrap hidden md:table-cell" }, p.variants.length || 1),
                                e('td', { className: "px-6 py-4 whitespace-nowrap text-left text-sm font-medium" },
                                    e(PrimaryButton, { onClick: () => openModal(p), className: "p-2 ml-2", isSecondary: true }, e(Icon, { name: 'edit', className: "w-4 h-4" })),
                                    e(PrimaryButton, { onClick: () => updateData('products', { id: p.id }, true), className: "p-2", isDanger: true }, e(Icon, { name: 'delete', className: "w-4 h-4" }))
                                )
                            )
                        })
                    )
                )
            );

            // Modal style adjusted for Neumorphism
            const modalStyle = {
                backgroundColor: '#e0e5ec',
                boxShadow: '10px 10px 20px #a3b1c6, -10px -10px 20px #ffffff'
            };

            const ProductModal = isModalOpen && e('div', { className: "fixed inset-0 bg-gray-900 bg-opacity-40 flex items-center justify-center z-50 p-4" },
                e('div', { className: "w-full max-w-4xl max-h-[90vh] overflow-y-auto neumo-card", style: modalStyle },
                    e('h3', { className: "text-2xl font-bold text-gray-800 mb-4 border-b border-gray-300 pb-2" }, currentProduct ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬' : 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯'),
                    
                    e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                        e('div', null, e('label', { className: "block text-gray-700 mb-1" }, 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬'), e('input', { type: 'text', name: 'name', value: productForm.name, onChange: handleChange, className: "neumo-input" })),
                        e('div', null, e('label', { className: "block text-gray-700 mb-1" }, 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø±.Ø³)'), e('input', { type: 'number', name: 'price', value: productForm.price, onChange: handleChange, className: "neumo-input", min: "0", step: "0.01" })),
                        e('div', null,
                            e('label', { className: "block text-gray-700 mb-1" }, 'Ø§Ù„Ù‚Ø³Ù…'),
                            e('select', { name: 'categoryId', value: productForm.categoryId, onChange: handleChange, className: "neumo-input" },
                                categories.length > 0 ? categories.map(cat => e('option', { key: cat.id, value: cat.id }, cat.name)) : e('option', { value: '' }, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù…')
                            )
                        ),
                        e('div', { className: "md:col-span-2" }, e('label', { className: "block text-gray-700 mb-1" }, 'Ø§Ù„ÙˆØµÙ'), e('textarea', { name: 'description', value: productForm.description, onChange: handleChange, className: "neumo-input h-24" })),
                    ),
                    
                    e('h4', { className: "text-xl font-bold text-gray-800 mb-3 mt-6 border-b border-gray-300 pb-1" }, 'Ø§Ù„ØµÙˆØ±'),
                    e('div', { className: "mb-4" },
                        e('input', { type: 'file', onChange: handleImageUpload, accept: 'image/*', multiple: true, className: "neumo-input file:text-white file:bg-primary file:border-none file:rounded-xl file:cursor-pointer" }),
                        e('div', { className: "flex flex-wrap gap-3 mt-4" },
                            Object.entries(productForm.images).map(([id, dataUrl]) => e('div', { key: id, className: "relative group" },
                                e('img', { src: dataUrl, className: "w-20 h-20 object-cover rounded-lg neumo-card !p-0" }),
                                e('button', {
                                    onClick: () => removeImage(id),
                                    className: "absolute top-0 right-0 bg-red-600 rounded-full w-5 h-5 flex items-center justify-center text-white text-xs opacity-0 group-hover:opacity-100 transition",
                                    title: "Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©"
                                }, e(Icon, { name: 'close', className: "w-3 h-3" }))
                            ))
                        )
                    ),
                    
                    e('h4', { className: "text-xl font-bold text-gray-800 mb-3 mt-6 border-b border-gray-300 pb-1" }, 'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ (Variants)'),
                    e(PrimaryButton, { onClick: addVariant, className: "mb-4 text-sm" }, 'Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯'),
                    
                    productForm.variants.map((v, index) => e('div', { key: v.id, className: "neumo-card p-4 rounded-xl mb-3" },
                        e('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-4" },
                            e('div', null, e('label', { className: "block text-gray-700 mb-1 text-sm" }, 'Ø§Ù„Ù„ÙˆÙ†'), e('input', { type: 'text', value: v.color, onChange: (e) => updateVariant(index, 'color', e.target.value), className: "neumo-input" })),
                            e('div', null, e('label', { className: "block text-gray-700 mb-1 text-sm" }, 'Ø§Ù„Ø­Ø¬Ù…/Ø§Ù„Ù…Ù‚Ø§Ø³'), e('input', { type: 'text', value: v.size, onChange: (e) => updateVariant(index, 'size', e.target.value), className: "neumo-input" })),
                            e('div', null, e('label', { className: "block text-gray-700 mb-1 text-sm" }, 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± (Â±)'), e('input', { type: 'number', value: v.priceAdjustment, onChange: (e) => updateVariant(index, 'priceAdjustment', parseFloat(e.target.value) || 0), className: "neumo-input", step: "0.01" })),
                            e('div', { className: "flex items-end justify-end" }, e(PrimaryButton, { onClick: () => removeVariant(v.id), className: "p-2", isDanger: true }, e(Icon, { name: 'trash', className: "w-5 h-5" })))
                        ),
                        e('div', { className: "mt-4 border-t border-gray-300 pt-3" },
                            e('p', { className: "text-gray-700 text-sm mb-2" }, 'Ø±Ø¨Ø· ØµÙˆØ± Ø§Ù„Ø®ÙŠØ§Ø±:'),
                            e('div', { className: "flex flex-wrap gap-2" },
                                Object.entries(productForm.images).map(([id, dataUrl]) => e('button', {
                                    key: id,
                                    onClick: () => toggleVariantImage(index, id),
                                    className: `w-12 h-12 object-cover rounded-md border-2 p-0.5 transition ${v.imageIds.includes(id) ? 'border-primary' : 'border-transparent hover:border-gray-400'}`
                                }, e('img', { src: dataUrl, className: "w-full h-full object-cover rounded-md" }))
                                )
                            )
                        )
                    )),
                    
                    e('div', { className: "flex justify-end space-x-2 space-x-reverse mt-8 pt-4 border-t border-gray-300" },
                        e(PrimaryButton, { onClick: closeModal, className: "!bg-gray-300 text-gray-700 neumo-btn" }, 'Ø¥Ù„ØºØ§Ø¡'),
                        e(PrimaryButton, { onClick: handleSave, isSuccess: true }, 'Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬')
                    )
                )
            );
            
            return e('div', null,
                e('div', { className: "flex justify-between items-center mb-6" },
                    e('h2', { className: "text-2xl font-bold text-gray-800" }, 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª'),
                    e(PrimaryButton, { onClick: () => openModal(), disabled: categories.length === 0, isSuccess: true }, e(Icon, { name: 'plus', className: "w-5 h-5 ml-2" }), 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬')
                ),
                categories.length === 0 && e('p', { className: "text-red-500 mb-4 neumo-card" }, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.'),
                ProductTable,
                ProductModal
            );
        };


        /**
         * Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø£Ù…Ø§Ù† (Ù…Ø­Ø¯Ø«)
         */
        const SettingsManager = () => {
            // ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙˆØ¸Ø§Ø¦Ù IndexedDB
            const { settings, saveSettings, exportJson, importJson, exportExcel, deleteAllData, lastBackupDate, showAlert, setIsAdminAuthenticated } = React.useContext(AppContext);
            
            // Ø­Ø§Ù„Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©
            const [whatsapp, setWhatsapp] = useState(settings.whatsappNumber || '');
            const [storeName, setStoreName] = useState(settings.storeName || '');
            const [storeImage, setStoreImage] = useState(settings.storeImage || '');
            
            // Ø­Ø§Ù„Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const [currentPassword, setCurrentPassword] = useState('');
            const [newPassword, setNewPassword] = useState('');
            const [confirmNewPassword, setConfirmNewPassword] = useState('');
            
            const fileInputRef = useRef(null);

            // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©
            const handleSaveBranding = () => {
                saveSettings({ 
                    whatsappNumber: whatsapp.trim(),
                    storeName: storeName.trim(),
                    storeImage: storeImage
                });
            };
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø± (ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Base64)
            const handleStoreImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => { setStoreImage(event.target.result); };
                reader.onerror = () => showAlert('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø©.', 'error');
                reader.readAsDataURL(file);
            };

            // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            const handleChangePassword = async () => {
                if (currentPassword !== settings.adminPassword) {
                    return showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.', 'error');
                }
                if (!newPassword || newPassword.length < 5) {
                    return showAlert('ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 5 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.', 'warning');
                }
                if (newPassword !== confirmNewPassword) {
                    return showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†.', 'error');
                }
                
                const result = await saveSettings({ adminPassword: newPassword });
                if (result) {
                    setCurrentPassword('');
                    setNewPassword('');
                    setConfirmNewPassword('');
                    setIsAdminAuthenticated(false); // Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    showAlert('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.', 'success', 5000);
                }
            };


            return e('div', null,
                e('h2', { className: "text-2xl font-bold text-gray-800 mb-6 border-b border-gray-300 pb-2" }, 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„Ø£Ù…Ø§Ù†'),
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© (Ø¬Ø¯ÙŠØ¯)
                e('div', { className: "neumo-card mb-6" },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© Ù„Ù„Ù…ØªØ¬Ø±'),
                    e('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                        e('div', null,
                            e('label', { className: "block text-gray-700 mb-2" }, 'Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±'),
                            e('input', { 
                                type: 'text', 
                                value: storeName, 
                                onChange: (e) => setStoreName(e.target.value), 
                                className: "neumo-input", 
                                placeholder: 'Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±'
                            })
                        ),
                        e('div', null,
                            e('label', { className: "block text-gray-700 mb-2" }, 'ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø± (Ø´Ø¹Ø§Ø±)'),
                            storeImage && e('img', { src: storeImage, className: "w-20 h-20 object-cover rounded-lg mb-2 neumo-card !p-0" }),
                            e('input', {
                                type: 'file',
                                onChange: handleStoreImageUpload,
                                accept: 'image/*',
                                className: "neumo-input file:text-white file:bg-primary file:border-none file:rounded-xl file:cursor-pointer"
                            })
                        )
                    ),
                    e(PrimaryButton, { onClick: handleSaveBranding, className: "mt-4 w-full md:w-auto", isSuccess: true }, 'Ø­ÙØ¸ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©')
                ),
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§ØªØ³Ø§Ø¨
                e('div', { className: "neumo-card mb-6" },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§ØªØ³Ø§Ø¨'),
                    e('label', { className: "block text-gray-700 mb-2" }, 'Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©ØŒ Ù…Ø«Ø§Ù„: 966500000000)'),
                    e('div', { className: "flex space-x-2 space-x-reverse" },
                        e('input', { 
                            type: 'tel', 
                            value: whatsapp, 
                            onChange: (e) => setWhatsapp(e.target.value), 
                            className: "neumo-input flex-grow", 
                            placeholder: 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ',
                            dir: "ltr"
                        }),
                        e(PrimaryButton, { onClick: handleSaveBranding, isSuccess: true }, 'Ø­ÙØ¸')
                    ),
                    whatsapp && e('p', { className: "text-green-600 text-sm mt-2" }, `Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ø¬Ø§Ù‡Ø²: https://wa.me/${whatsapp}`)
                ),

                // ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø¬Ø¯ÙŠØ¯)
                e('div', { className: "neumo-card mb-6" },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±'),
                    e('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
                        e('div', null, e('label', { className: "block text-gray-700 mb-1" }, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©'), e('input', { type: 'password', value: currentPassword, onChange: (e) => setCurrentPassword(e.target.value), className: "neumo-input", placeholder: 'Ø§Ù„Ø­Ø§Ù„ÙŠØ©' })),
                        e('div', null, e('label', { className: "block text-gray-700 mb-1" }, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©'), e('input', { type: 'password', value: newPassword, onChange: (e) => setNewPassword(e.target.value), className: "neumo-input", placeholder: 'Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' })),
                        e('div', null, e('label', { className: "block text-gray-700 mb-1" }, 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'), e('input', { type: 'password', value: confirmNewPassword, onChange: (e) => setConfirmNewPassword(e.target.value), className: "neumo-input", placeholder: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' })),
                    ),
                    e(PrimaryButton, { onClick: handleChangePassword, className: "mt-4 w-full md:w-auto neumo-btn-primary" }, 'ØªØºÙŠÙŠØ± ÙˆØ­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±')
                ),

                // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø£Ù…Ø§Ù†
                e('div', { className: "neumo-card" },
                    e('h3', { className: "text-xl font-bold text-gray-800 mb-4" }, 'Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø£Ù…Ø§Ù† (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©)'),
                    e('p', { className: "text-sm text-gray-600 mb-4" }, 
                        `Ø¢Ø®Ø± ØªØ§Ø±ÙŠØ® Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ: ${lastBackupDate ? new Date(lastBackupDate).toLocaleString('ar-EG', { dateStyle: 'medium', timeStyle: 'short' }) : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ø¹Ø¯'}`
                    ),
                    e('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                        e(PrimaryButton, { onClick: exportJson, className: "text-sm flex items-center justify-center neumo-btn-primary" }, e(Icon, { name: 'file-json', className: "w-5 h-5 ml-2" }), 'ØªØµØ¯ÙŠØ± JSON'),
                        e(PrimaryButton, { onClick: () => fileInputRef.current.click(), className: "text-sm flex items-center justify-center neumo-btn-primary" }, e(Icon, { name: 'import', className: "w-5 h-5 ml-2" }), 'Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON'),
                        e('input', { type: 'file', ref: fileInputRef, onChange: importJson, accept: '.json', className: "hidden" }),
                        e(PrimaryButton, { onClick: exportExcel, className: "text-sm flex items-center justify-center bg-green-500 text-white hover:bg-green-600" }, e(Icon, { name: 'file-excel', className: "w-5 h-5 ml-2" }), 'ØªØµØ¯ÙŠØ± Excel'),
                        e(PrimaryButton, { onClick: deleteAllData, className: "text-sm flex items-center justify-center", isDanger: true }, e(Icon, { name: 'trash', className: "w-5 h-5 ml-2" }), 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª')
                    ),
                    e('p', { className: "text-yellow-600 text-xs mt-6 border-t border-gray-300 pt-4" }, 
                        'Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ø¹Ø¨Ø± IndexedDB.'
                    )
                )
            );
        };

        /**
         * Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ¬Ø± (Admin Panel)
         */
        const AdminPanel = () => {
            const { setPage, isAdminAuthenticated, setIsAdminAuthenticated } = React.useContext(AppContext);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Ø­Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„Ù€ URL Ù…Ø¨Ø§Ø´Ø±Ø©)
            useEffect(() => {
                if (!isAdminAuthenticated) {
                    setPage('adminLogin');
                }
            }, [isAdminAuthenticated, setPage]);

            if (!isAdminAuthenticated) {
                return e(LoadingSpinner); // ÙŠÙØ¶Ù„ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙ„ÙƒÙ† Ø³Ù†Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„ Ù…Ø¤Ù‚ØªÙ‹Ø§
            }

            const [activeTab, setActiveTab] = useState('dashboard');
            
            const renderContent = () => {
                switch (activeTab) {
                    case 'categories': return e(CategoryManager);
                    case 'products': return e(ProductManager);
                    case 'settings': return e(SettingsManager);
                    case 'dashboard':
                    default: return e(Dashboard);
                }
            };
            
            const tabs = [
                { id: 'dashboard', name: 'Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©', icon: 'dashboard' },
                { id: 'categories', name: 'Ø§Ù„Ø£Ù‚Ø³Ø§Ù…', icon: 'list' },
                { id: 'products', name: 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', icon: 'shop' },
                { id: 'settings', name: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ù…Ø§Ù†', icon: 'settings' },
            ];
            
            return e('div', { className: "max-w-7xl mx-auto" },
                e('div', { className: "flex justify-between items-center mb-6" },
                    e(PrimaryButton, { onClick: () => { setIsAdminAuthenticated(false); setPage('home'); }, isDanger: true, className: "flex items-center" }, 
                        'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬'
                    ),
                    e('h1', { className: "text-3xl font-extrabold text-gray-800" }, 'Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ¬Ø±')
                ),

                e('div', { className: "flex flex-wrap border-b border-gray-300 mb-8 neumo-card rounded-2xl p-2 justify-center" },
                    tabs.map(tab => e('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `py-2 px-4 md:px-6 rounded-xl transition-all text-sm md:text-base font-medium flex items-center m-1 ${activeTab === tab.id ? 'bg-primary text-white shadow-lg' : 'text-gray-700 hover:bg-neumo-base neumo-btn'}`
                    }, e(Icon, { name: tab.icon, className: "w-5 h-5 ml-2" }), tab.name))
                ),
                renderContent()
            );
        };


        // ====================================================================================
        // 6. Shop Components - Ù…ÙƒÙˆÙ†Ø§Øª ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ³ÙˆÙ‚
        // ====================================================================================

        /**
         * Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© (Fixed Bottom)
         */
        const ShopCart = () => {
            const { cart, updateCart, clearCart, settings, showAlert } = React.useContext(AppContext);
            
            const cartItems = useMemo(() => Object.values(cart), [cart]);
            const total = useMemo(() => 
                cartItems.reduce((sum, item) => sum + item.quantity * (item.product.price + item.variant.priceAdjustment), 0)
            , [cartItems]);

            const createWhatsappMessage = () => {
                if (!settings.whatsappNumber) return '#';
                
                let message = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ø·Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\n';
                cartItems.forEach(item => {
                    const variantName = (item.variant.color || item.variant.size) ? ` (${item.variant.color} ${item.variant.size})` : '';
                    const itemPrice = item.product.price + item.variant.priceAdjustment;
                    message += `* ${item.product.name}${variantName}\n`;
                    message += `   Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity} | Ø§Ù„Ø³Ø¹Ø±: ${itemPrice.toFixed(2)} Ø±.Ø³\n`;
                });
                message += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø±.Ø³`;
                
                return `https://wa.me/${settings.whatsappNumber}?text=${encodeURIComponent(message)}`;
            };

            const whatsappLink = createWhatsappMessage();

            return e('div', { className: "shop-cart fixed bottom-0 right-0 left-0 neumo-card p-4 shadow-2xl z-40 border-t border-gray-300" },
                e('div', { className: "max-w-7xl mx-auto flex flex-wrap justify-between items-center text-gray-800" },
                    e('div', { className: "flex flex-col mb-2 sm:mb-0" },
                        e('p', { className: "text-lg font-bold" }, `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø±.Ø³`),
                        e('p', { className: "text-sm text-gray-600" }, `${cartItems.length} ØµÙ†Ù ÙÙŠ Ø§Ù„Ø³Ù„Ø©`)
                    ),
                    
                    e('div', { className: "flex space-x-2 space-x-reverse" },
                        e(PrimaryButton, { 
                            onClick: () => showAlert(
                                cartItems.length > 0 ? cartItems.map(i => `${i.product.name} - ${i.variant.color || i.variant.size} (Ã—${i.quantity})`).join('\n') : 'Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.',
                                'info', 10000
                            ),
                            className: "neumo-btn neumo-btn-secondary flex items-center text-sm px-3 py-2" // Secondary Button
                        }, e(Icon, { name: 'cart', className: "w-4 h-4 ml-1" }), 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ù„Ø©'),
                        
                        e(PrimaryButton, { onClick: clearCart, className: "neumo-btn !bg-red-500 text-white hover:!bg-red-600 flex items-center text-sm px-3 py-2", disabled: cartItems.length === 0, isDanger: true }, 'Ø¥ÙØ±Ø§Øº'), // Danger Button

                        e('a', { 
                            href: whatsappLink, 
                            target: "_blank",
                            rel: "noopener noreferrer",
                            onClick: (e) => { 
                                if (cartItems.length === 0) { 
                                    e.preventDefault(); 
                                    showAlert('Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙØ§Ø±ØºØ©.', 'warning');
                                } else if (whatsappLink === '#') { 
                                    e.preventDefault(); 
                                    showAlert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.', 'error');
                                }
                            },
                            className: `neumo-btn bg-green-500 text-white hover:bg-green-600 flex items-center text-sm px-4 py-2 ${cartItems.length === 0 || whatsappLink === '#' ? 'opacity-50 cursor-not-allowed !shadow-none' : ''}` // Success Button
                        }, e(Icon, { name: 'whatsapp', className: "w-5 h-5 ml-2" }), 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨')
                    )
                )
            );
        };

        /**
         * Ù…ÙƒÙˆÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„ØªÙØµÙŠÙ„ (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø±)
         */
        const ProductDetail = ({ product, onBack, categories }) => {
            const { updateCart, showAlert } = React.useContext(AppContext);
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§ØªØŒ Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø®ÙŠØ§Ø± ÙˆÙ‡Ù…ÙŠ)
            const defaultVariant = product.variants && product.variants.length > 0 ? product.variants[0] : { id: 'default', priceAdjustment: 0, imageIds: [] };
            
            // Ø­Ø§Ù„Ø§Øª Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø®ÙŠØ§Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù„Ù„Ø¥Ø¶Ø§ÙØ©
            const [selectedVariant, setSelectedVariant] = useState(defaultVariant);
            const [quantity, setQuantity] = useState(1);
            
            const basePrice = product.price;
            const finalPrice = basePrice + (selectedVariant ? selectedVariant.priceAdjustment : 0);
            const category = categories.find(c => c.id === product.categoryId);
            
            const mainImage = useMemo(() => {
                const imageIds = selectedVariant.imageIds && selectedVariant.imageIds.length > 0
                    ? selectedVariant.imageIds
                    : Object.keys(product.images);
                const firstImageId = imageIds[0];
                return product.images[firstImageId] || 'https://placehold.co/600x400/d1d5db/4b5563?text=No+Image';
            }, [product.images, selectedVariant]);
            
            const handleAddToCart = () => {
                if (quantity <= 0) {
                    return showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…ÙŠØ© ØµØ§Ù„Ø­Ø©.', 'warning');
                }
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®ÙŠØ§Ø±Ø§Øª
                if (product.variants && product.variants.length > 0 && !selectedVariant) {
                    return showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø£ÙˆÙ„Ø§Ù‹.', 'warning');
                }

                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Ù‹ Ù„Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„ÙŠÙ‡
                const variantToUse = selectedVariant || { id: 'default', priceAdjustment: 0 };
                
                // ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
                updateCart(product, variantToUse, quantity);
                setQuantity(1); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            };

            return e('div', { className: "max-w-4xl mx-auto pb-24" }, 
                e(PrimaryButton, { onClick: onBack, className: "neumo-btn !bg-neumo-base text-gray-700 hover:text-gray-900 flex items-center mb-6" }, 
                    e(Icon, { name: 'back', className: "w-5 h-5 ml-2" }), 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª'
                ),

                e('div', { className: "neumo-card grid grid-cols-1 lg:grid-cols-2 gap-8" },
                    e('div', { className: "rounded-xl overflow-hidden neumo-card shadow-lg p-2" },
                        e('img', { 
                            src: mainImage, 
                            alt: product.name, 
                            className: "w-full h-80 object-cover rounded-lg" 
                        }),
                        e('div', { className: "flex flex-wrap gap-2 mt-4" },
                            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„
                            Object.entries(product.images).map(([id, url]) => {
                                // ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹
                                const isAssociatedWithSelectedVariant = selectedVariant.imageIds.includes(id);
                                return e('img', { 
                                    key: id,
                                    src: url,
                                    className: `w-16 h-16 object-cover rounded-md border-2 cursor-pointer transition ${isAssociatedWithSelectedVariant ? 'border-primary' : 'border-transparent hover:border-gray-400'}`
                                });
                            })
                        )
                    ),
                    
                    e('div', null,
                        e('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, product.name),
                        e('p', { className: "text-sm text-primary mb-4" }, category ? category.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'),
                        
                        e('div', { className: "text-4xl font-extrabold text-secondary mb-6 border-b border-gray-300 pb-4" }, 
                            `${finalPrice.toFixed(2)} Ø±.Ø³`
                        ),
                        
                        e('p', { className: "text-gray-700 mb-6" }, product.description),
                        
                        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Variants) - Ù…Ø·Ù„ÙˆØ¨ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Øª
                        product.variants && product.variants.length > 0 && e('div', { className: "mb-6" },
                            e('label', { className: "block text-gray-700 mb-2 font-medium" }, 'Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:'),
                            e('div', { className: "flex flex-wrap gap-2" },
                                product.variants.map(v => e('button', {
                                    key: v.id,
                                    onClick: () => {
                                        setSelectedVariant(v);
                                        setQuantity(1); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ…ÙŠØ© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ÙŠØ§Ø±
                                    },
                                    className: `py-2 px-4 rounded-full text-sm transition neumo-btn ${selectedVariant.id === v.id ? 'bg-primary text-white shadow-inner' : 'bg-neumo-base text-gray-700'}`
                                }, `${v.color || ''} ${v.size || ''} (${v.priceAdjustment >= 0 ? '+' : ''}${v.priceAdjustment.toFixed(2)} Ø±.Ø³)`))
                            )
                        ),
                        
                        e('div', { className: "flex items-center space-x-4 space-x-reverse mt-8" },
                            e('div', { className: "flex items-center neumo-card rounded-xl p-1 !shadow-inner !py-0" },
                                e('button', { 
                                    onClick: () => setQuantity(q => Math.max(1, q - 1)), 
                                    className: "w-8 h-8 flex items-center justify-center text-xl text-gray-700 hover:text-gray-900 rounded-lg neumo-btn !shadow-none" 
                                }, 'âˆ’'),
                                e('input', { 
                                    type: 'number', 
                                    value: quantity, 
                                    onChange: (e) => setQuantity(parseInt(e.target.value) || 1), 
                                    className: "w-12 text-center neumo-input !bg-neumo-base border-none focus:ring-0 !shadow-none",
                                    min: "1"
                                }),
                                e('button', { 
                                    onClick: () => setQuantity(q => q + 1), 
                                    className: "w-8 h-8 flex items-center justify-center text-xl text-gray-700 hover:text-gray-900 rounded-lg neumo-btn !shadow-none" 
                                }, '+')
                            ),
                            
                            e(PrimaryButton, { onClick: handleAddToCart, className: "flex-grow flex justify-center items-center text-lg neumo-btn-primary" }, 
                                e(Icon, { name: 'cart', className: "w-5 h-5 ml-2" }), 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©'
                            )
                        )
                    )
                )
            );
        };


        /**
         * ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØªØ³ÙˆÙ‚
         */
        const ShopView = () => {
            const { products, categories, setPage, settings } = React.useContext(AppContext);
            // 1. Hooks MUST be called unconditionally at the top level
            const [selectedCategoryId, setSelectedCategoryId] = useState(null); 
            const [selectedProduct, setSelectedProduct] = useState(null); 
            
            const filteredProducts = useMemo(() => {
                if (!selectedCategoryId) return [];
                return products.filter(p => p.categoryId === selectedCategoryId);
            }, [products, selectedCategoryId]);

            // 2. Conditional Return is moved here, after all Hooks
            if (selectedProduct) {
                return e(ProductDetail, { 
                    product: selectedProduct, 
                    onBack: () => setSelectedProduct(null),
                    categories: categories
                });
            }

            const renderContent = () => {
                if (categories.length === 0) {
                     return e('p', { className: "text-center text-gray-500 py-16 text-xl neumo-card" }, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø­Ø§Ù„ÙŠÙ‹Ø§.');
                }
                
                if (!selectedCategoryId) {
                    return e('div', { className: "grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 pb-24" },
                        categories.map(cat => e('button', {
                            key: cat.id,
                            onClick: () => setSelectedCategoryId(cat.id),
                            className: "neumo-card p-4 flex flex-col items-center justify-center text-gray-800 hover:bg-neumo-base transition rounded-xl transform hover:scale-[1.02] active:scale-[0.98]"
                        },
                            cat.image ? e('img', { src: cat.image, alt: cat.name, className: "w-20 h-20 object-cover rounded-full mb-3 neumo-card !p-0" }) : e(Icon, { name: 'list', className: "w-12 h-12 text-primary mb-3" }),
                            e('p', { className: "font-bold text-lg" }, cat.name)
                        ))
                    );
                } else {
                    const selectedCat = categories.find(c => c.id === selectedCategoryId);
                    return e('div', null,
                        e('div', { className: "flex items-center mb-6" },
                            e(PrimaryButton, { onClick: () => setSelectedCategoryId(null), className: "neumo-btn !bg-neumo-base text-gray-700 hover:text-gray-900 flex items-center text-sm" }, 
                                e(Icon, { name: 'back', className: "w-4 h-4 ml-2" }), 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù‚Ø³Ø§Ù…'
                            ),
                            e('h2', { className: "text-2xl font-bold text-gray-800 mr-4" }, selectedCat ? selectedCat.name : 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª')
                        ),
                        
                        filteredProducts.length === 0 
                            ? e('p', { className: "text-center text-gray-500 py-10 neumo-card" }, 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù….')
                            : e('div', { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pb-24" },
                                filteredProducts.map(p => e('div', { 
                                    key: p.id,
                                    onClick: () => setSelectedProduct(p),
                                    className: "neumo-card p-4 flex flex-col cursor-pointer hover:bg-neumo-base transition rounded-xl transform hover:scale-[1.02] active:scale-[0.98]"
                                },
                                    e('img', { 
                                        src: Object.values(p.images)[0] || 'https://placehold.co/400x300/d1d5db/4b5563?text=Product', 
                                        alt: p.name, 
                                        className: "w-full h-48 object-cover rounded-lg mb-4 neumo-card !p-0"
                                    }),
                                    e('h3', { className: "text-xl font-bold text-gray-800 truncate" }, p.name),
                                    e('p', { className: "text-secondary font-extrabold text-2xl mt-2" }, `${p.price.toFixed(2)} Ø±.Ø³`),
                                    e('p', { className: "text-gray-700 text-sm mt-1 mb-4 line-clamp-2" }, p.description),
                                    e(PrimaryButton, { onClick: (e) => { e.stopPropagation(); setSelectedProduct(p); }, className: "mt-auto neumo-btn-secondary" }, 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„')
                                ))
                            )
                    );
                }
            };
            
            return e('div', { className: "max-w-7xl mx-auto" },
                e('div', { className: "flex justify-between items-center mb-8" },
                    e('h1', { className: "text-3xl font-extrabold text-gray-800" }, settings.storeName || 'Ø§Ù„Ù…ØªØ³ÙˆÙ‚'),
                    e(PrimaryButton, { onClick: () => setPage('home'), className: "neumo-btn !bg-neumo-base text-gray-700 hover:text-gray-900 flex items-center" }, 
                        e(Icon, { name: 'home', className: "w-5 h-5 ml-2" }), 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'
                    )
                ),
                renderContent(),
                e(ShopCart) 
            );
        };

        // ====================================================================================
        // 7. Main Application Flow - ØªØ¯ÙÙ‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø­Ø¯Ø«)
        // ====================================================================================

        /**
         * Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ø­Ø¯Ø«Ø©)
         */
        const HomeScreen = () => {
            const { setPage, settings } = React.useContext(AppContext);
            
            const defaultImage = 'https://placehold.co/200x200/6366f1/ffffff?text=Store';

            return e('div', { className: "min-h-[calc(100vh-64px)] flex flex-col items-center justify-center p-4" },
                e('div', { className: "neumo-card text-center p-8 md:p-12 max-w-lg w-full" },
                    
                    // ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø±
                    e('img', {
                        src: settings.storeImage || defaultImage,
                        alt: settings.storeName || 'ØµÙˆØ±Ø© Ø§Ù„Ù…ØªØ¬Ø±',
                        className: "w-40 h-40 object-cover rounded-full mx-auto mb-6 ring-4 ring-primary ring-opacity-50 shadow-xl neumo-card !p-0"
                    }),

                    // Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
                    e('h1', { className: "text-4xl md:text-5xl font-extrabold text-gray-800 mb-8" }, settings.storeName || 'Ù…ØªØ¬Ø±Ù†Ø§ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'),
                    
                    e('div', { className: "flex flex-col space-y-4" },
                        e(PrimaryButton, { onClick: () => setPage('adminLogin'), className: "text-xl flex items-center justify-center neumo-btn-primary" }, 
                            e(Icon, { name: 'admin', className: "w-7 h-7 ml-3" }), 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ØªØ¬Ø±'
                        ),
                        e(PrimaryButton, { onClick: () => setPage('shop'), className: "text-xl flex items-center justify-center neumo-btn-secondary", isSecondary: true }, 
                            e(Icon, { name: 'shop', className: "w-7 h-7 ml-3" }), 'Ø§Ù„Ù…ØªØ³ÙˆÙ‚'
                        )
                    )
                )
            );
        };


        /**
         * Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (App)
         */
        const App = () => {
            const { page, isLoading, isAdminAuthenticated } = React.useContext(AppContext);

            if (isLoading) {
                return e(LoadingSpinner);
            }

            switch (page) {
                case 'adminLogin':
                    return e(AdminLoginScreen);
                case 'admin':
                    return isAdminAuthenticated ? e(AdminPanel) : e(AdminLoginScreen);
                case 'shop':
                    return e(ShopView);
                case 'home':
                default:
                    return e(HomeScreen);
            }
        };

        // ====================================================================================
        // 8. Initialization - ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ====================================================================================
        
        // Ù†Ù‚Ø·Ø© Ø¥Ø¯Ø®Ø§Ù„ React
        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        
        root.render(e(AppProvider, null, e(App)));
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAQE_hCUNxo9_hFhSLa0yPY-dN8fZfEoos",
    authDomain: "cleane-center-shop.firebaseapp.com",
    projectId: "cleane-center-shop",
    storageBucket: "cleane-center-shop.firebasestorage.app",
    messagingSenderId: "687911431635",
    appId: "1:687911431635:web:d6580e3dc25f6b3cf49326",
    measurementId: "G-TXDX6L3RV5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
 <!-- ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Firestore + Auth -->
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  // Ø±Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹ Firebase
  const db = getFirestore(app);
  const auth = getAuth(app);

  console.log("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Firestore Ùˆ Auth Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚");
 </script>
<!-- ğŸ”¥ Firestore + Auth ØªÙ… ØªÙØ¹ÙŠÙ„Ù‡Ù…Ø§ Ø¨Ù†Ø¬Ø§Ø­ -->
<script type="module">
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

  // âœ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ù‡ÙŠØ£ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±
  const app = getApps().length ? getApp() : null;
  const db = app ? getFirestore(app) : null;
  const auth = app ? getAuth(app) : null;

  console.log("âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Firestore Ùˆ Auth Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ");

  // ==============================
  // â˜ï¸ Cloudinary Integration
  // ==============================
  const cloudName = "db06mnv5v";        // Cloud Name Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ
  const uploadPreset = "auto_upload";   // Ø£Ù†Ø´Ø¦Ù‡ Ø¯Ø§Ø®Ù„ Cloudinary ÙƒÙ€ unsigned
  const apiKey = "589576864932678";     // API Key ÙÙ‚Ø· (Ø¢Ù…Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„)

  // ğŸ”„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Cloudinary
  async function autoUploadToCloudinary(file) {
    try {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", uploadPreset);
      formData.append("api_key", apiKey);

      const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
        method: "POST",
        body: formData,
      });

      const data = await response.json();
      if (!response.ok) throw new Error(data.error?.message || "ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹");

      const fileUrl = data.secure_url;
      console.log("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Cloudinary:", fileUrl);

      // ğŸ’¾ Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù ÙÙŠ Firestore (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      if (db) {
        await addDoc(collection(db, "uploads"), {
          url: fileUrl,
          type: file.type.startsWith("video") ? "video" : "image",
          user: auth?.currentUser?.email || "Ø²Ø§Ø¦Ø±",
          createdAt: new Date().toISOString(),
        });
        console.log("ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firestore");
      }

      return fileUrl;
    } catch (error) {
      console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹:", error);
    }
  }

  // ğŸ¯ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£ÙŠ Ø­Ù‚Ù„ Ù…Ù† Ù†ÙˆØ¹ Ù…Ù„Ù Ø¯Ø§Ø®Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  document.addEventListener("change", async (e) => {
    if (e.target && e.target.type === "file" && e.target.files?.length > 0) {
      const file = e.target.files[0];
      console.log("â« Ø¨Ø¯Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù:", file.name);
      await autoUploadToCloudinary(file);
    }
  });
</script>
<!-- ğŸ–¼ï¸ Ù‚Ø³Ù… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø© Ù…Ù† Cloudinary -->
<script type="module">
  import { collection, onSnapshot, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // âœ… Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ db Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  const uploadsFeed = document.createElement("div");
  uploadsFeed.id = "uploads-feed";
  uploadsFeed.style.display = "grid";
  uploadsFeed.style.gridTemplateColumns = "repeat(auto-fill, minmax(200px, 1fr))";
  uploadsFeed.style.gap = "10px";
  uploadsFeed.style.padding = "15px";
  uploadsFeed.style.background = "#f9f9f9";
  uploadsFeed.style.borderTop = "2px solid #eee";
  uploadsFeed.innerHTML = "<h3 style='grid-column:1/-1;text-align:center;'>ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>";
  document.body.appendChild(uploadsFeed);
</script>
<input type="file" id="uploadInput" style="display:block;margin:20px;">
</body>
</html>
